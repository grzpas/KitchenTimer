<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Kitchen Timer</title>
    <link rel="stylesheet" href="./css/jquery.mobile-1.3.0.css"/>
    <script type="text/javascript" src="./js/jquery-1.8.3.js"></script>
    <script type="text/javascript" src="./js/jquery.mobile-1.3.0.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/shake.css" />
    <script>
    document.addEventListener("deviceready", onDeviceReady, false);
    function onDeviceReady() {
        var checkHour;
        var checkMinute;
        var checkSecond;
        // change to "/android_asset/www/alarm.mp3"
        var src="alarm.mp3";
        (function($){

            $.extend({

                APP : {

                    formatTimer : function(a) {
                        if (a < 10) {
                            a = '0' + a;
                        }
                        return a;
                    },

                    startTimer : function(dir, inputTime) {
                        // save type
                        $.APP.dir = dir;

                        // get current date
                        $.APP.d1 = new Date();

                        switch($.APP.state) {

                            case 'pause' :

                                // resume timer
                                // get current timestamp (for calculations) and
                                // substract time difference between pause and now
                                $.APP.t1 = $.APP.d1.getTime() - $.APP.td;

                                break;

                            default :

                                // get current timestamp (for calculations)
                                $.APP.t1 = $.APP.d1.getTime();

                                // if countdown add ms based on seconds in textfield
                                if ($.APP.dir === 'cd') {

                                    $.APP.t1 += inputTime*1000;
                                };

                                break;

                        }

                        // reset state
                        $.APP.state = 'alive';
                        $('#' + $.APP.dir + '_status').html('Running');

                        // start loop
                        $.APP.loopTimer();

                    },

                    pauseTimer : function() {

                        // save timestamp of pause
                        $.APP.dp = new Date();
                        $.APP.tp = $.APP.dp.getTime();

                        // save elapsed time (until pause)
                        $.APP.td = $.APP.tp - $.APP.t1;

                        // change button value
                        $('#' + $.APP.dir + '_start').val('Resume');

                        // set state
                        $.APP.state = 'pause';
                        $('#' + $.APP.dir + '_status').html('Paused');

                    },

                    stopTimer : function() {

                        // change button value
                        $('#' + $.APP.dir + '_start').val('Restart');

                        // set state
                        $.APP.state = 'stop';
                        $('#' + $.APP.dir + '_status').html('Stopped');

                    },

                    resetTimer : function() {

                        // reset display
                        $('#' + $.APP.dir + '_ms,#' + $.APP.dir + '_s,#' + $.APP.dir + '_m,#' + $.APP.dir + '_h').html('00');

                        // change button value
                        $('#' + $.APP.dir + '_start').val('Start');

                        // set state
                        $.APP.state = 'reset';
                        $('#' + $.APP.dir + '_status').html('Reset & Idle again');

                    },

                    endTimer : function(callback) {

                        // change button value
                        $('#' + $.APP.dir + '_start').val('Restart');

                        // set state
                        $.APP.state = 'end';

                        // invoke callback
                        if (typeof callback === 'function') {
                            callback();
                        }

                    },

                    loopTimer : function() {

                        var td;
                        var d2,t2;

                        var ms = 0;
                        var s  = 0;
                        var m  = 0;
                        var h  = 0;

                        if ($.APP.state === 'alive') {

                            // get current date and convert it into
                            // timestamp for calculations
                            d2 = new Date();
                            t2 = d2.getTime();

                            // calculate time difference between
                            // initial and current timestamp
                            if ($.APP.dir === 'sw') {
                                td = t2 - $.APP.t1;
                                // reversed if countdown
                            } else {
                                td = $.APP.t1 - t2;
                                if (td <= 0) {

                                    // if time difference is 0 end countdown
                                    $.APP.endTimer(function(){
                                        $.APP.resetTimer();

                                        src = "http://audio.ibeat.org/content/p1rj1s/p1rj1s_-_rockGuitar.mp3";
                                        function onSuccess() {
                                            console.log("playAudio():Audio Success");

                                        }
                                        var media = new Media(src, onSuccess, null, null, null);
                                        media.play();
                                        //$.mobile.changePage('#popup', {transition: 'pop', role: 'dialog'});
                                        $('#' + $.APP.dir + '_status').html('Ended & Reset');

                                    });
                                }
                            }

                            // calculate milliseconds
                            ms = td%1000;
                            if (ms < 1) {
                                ms = 0;
                            } else {
                                // calculate seconds
                                s = (td-ms)/1000;
                                if (s < 1) {
                                    s = 0;
                                } else {
                                    // calculate minutes
                                    m = (s-(s%60))/60;
                                    if (m < 1) {
                                        m = 0;
                                    } else {
                                        // calculate hours
                                        h = (m-(m%60))/60;
                                        if (h < 1) {
                                            h = 0;
                                        }
                                    }
                                }
                            }

                            // substract elapsed minutes & hours
                            ms = Math.round(ms/100);
                            s  = s-(m*60);
                            m  = m-(h*60);

                            // update display

                            $('#' + $.APP.dir + '_s').html($.APP.formatTimer(s));
                            $('#' + $.APP.dir + '_m').html($.APP.formatTimer(m));
                            $('#' + $.APP.dir + '_h').html($.APP.formatTimer(h));

                            // loop
                            $.APP.t = setTimeout($.APP.loopTimer,1);

                        } else {

                            // kill loop
                            clearTimeout($.APP.t);
                            return true;

                        }

                    }

                }

            });

            $('#cd_start').live('click', function() {

                if (!parseInt($('#cd_inputHours').val())*3600){
                    checkHour=0;
                }
                else{checkHour= parseInt($('#cd_inputHours').val())*3600;};


                if (!parseInt($('#cd_inputMinutes').val())*3600){
                    checkMinute=0;
                }
                else{checkMinute= parseInt($('#cd_inputMinutes').val())*60;};


                if (!parseInt($('#cd_inputSeconds').val())*10){
                    checkSecond=0;
                }
                else{checkSecond= parseInt($('#cd_inputSeconds').val());};

                var inputTime;

                inputTime = checkHour + checkMinute + checkSecond;

                if (inputTime==0){
                    //navigator.notification.alert('Please enter at least one value 2', function onSuccess() {}, "Click", "Ok");
                    alert('Please enter at least one value');
                }
                else{
                    $.APP.startTimer('cd', inputTime);

                };
            });

            $('#cd_stop').live('click', function() {
                $.APP.stopTimer();
            });

            $('#cd_reset').live('click', function() {
                $.APP.resetTimer();
            });

            $('#cd_pause').live('click', function() {
                $.APP.pauseTimer();
            });

        })(jQuery);

    }
    </script>
</head>

<body>
    <!-- Start page: main -->
    <div data-role="page" id="main">
        <div data-role="header" data-theme="b">
           <img src="img/logo.png" style="height:35px; width: auto; padding-top: 3px; padding-left: 10px; float:left"/>
            <h1>Kitchen Timer</h1>
        </div><!-- /header -->
        <div  class="bg" data-role="content" data-theme="b">           
            <a href="#quick" data-role="button">Quick Timer</a>
            <a href="#chef" data-role="button">Chef's Timer</a>
        </div><!-- /content -->
        <div data-role="footer" data-position="fixed" data-theme="b">
            <h4>Page Footer</h4>
        </div><!-- /footer -->
    </div><!-- /page main -->


    <!-- Start of page: quick -->
    <div data-role="page" id="quick">
        <div data-role="header" data-theme="b">
            <img src="img/logo.png" style="height:35px; width: auto; padding-top: 3px; padding-left: 10px; float:left"/>
            <h1>Countdown</h1>
        </div><!-- /header -->
        <div class="bg" data-role="content" data-theme="b">
            <span id="cd_h">00</span>:
            <span id="cd_m">00</span>:
            <span id="cd_s">00</span>
            <br>
            <div class="floatInputButton">
                <input value="Start" id="cd_start" type="button">
            </div>
            <div class="floatInputButton">
                <input value="Pause" id="cd_pause" type="button">
            </div>
            <div class="floatInputButton">
                <input value="Stop" id="cd_stop" type="button">
            </div>
            <div class="floatInputButton">
                <input value="Reset" id="cd_reset" type="button">
            </div>
            <br>
            <input placeholder="hh" id="cd_inputHours" type="number">
            <input placeholder="mm" id="cd_inputMinutes" type="number">
            <input placeholder="ss" id="cd_inputSeconds" type="number">
            <br>

            <br><a href="#main" data-role="button" data-inline="true" data-icon="back">Back to home page</a>
            <span style="display:none" id="cd_status">Idle</span>
        </div><!-- /content -->

        <div data-role="footer" data-position="fixed" data-theme="b">
            <h1>Footer</h1>
        </div><!-- /footer -->
    </div><!-- /page quick -->


    <!-- Start of page: chef -->
    <div data-role="page" id="chef">
        <div data-role="header" data-theme="b">
            <img src="img/logo.png" style="height:35px; width: auto; padding-top: 3px; padding-left: 10px; float:left"/>
            <h1>Countdown</h1>
        </div><!-- /header -->
        <div class="bg" data-role="content" data-theme="b">
            <h1>
                TODO
            </h1>
        </div><!-- /content -->
        <div data-role="footer" data-position="fixed" data-theme="b">
            <h1>Footer</h1>
        </div><!-- /footer -->
    </div><!-- /page chef -->


      <!-- Start of third page: #popup -->
    <div data-role="page" id="popup">
        <div data-role="header" data-theme="b">
            <h1>Finished!</h1>
        </div><!-- /header -->

        <div data-role="content"data-theme="b" class="pop">
            <h2 class="popupHeading">Your dish is ready!</h2>
          <img class="shake shake-slow" src="img/logo.png" id="pot"/>
            <p>
                <a href="#main" data-role="button" data-inline="true"
                    data-icon="back">Back to home page</a>
            </p>
        </div><!-- /content -->

        <div data-role="footer" data-theme="b">
            <h1>Page Footer</h1>
        </div><!-- /footer -->
    </div><!-- /page popup -->

</body>
</html>